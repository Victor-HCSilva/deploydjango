{% extends 'base.html' %}

{% load static %}

{% block title %}Gerenciar pacientes{% endblock %}

{% block content %}

<link rel="stylesheet" href="{% static 'css/portal_do_paciente/style_gerenciar_pacientes.css' %}">
<script src="{% static 'js/js_gerenciar_pacientes.js' %}" defer></script>



<h1 style="text-align: center;">Gerenciamento</h1>
<br>


<div class="container">
    <div class="menu">
        <a href="#dados">Dados</a>

        <a href="#todas_as_consultas">Todas as consultas</a>

        <a href="#cadastro">Cadastro</a>

    </div>

</div>
<div class="container mt-3">
    <form method="get" class="d-flex mb-3">
        <div class="me-2">
            <label for="search" class="form-label">Buscar por nome:</label>
            <input class="form-control" type="search" placeholder="Digite o nome" name="search"
                value="{{ search_query }}">
            <br>
            <button class="btn btn-sm btn-primary" type="submit">Buscar</button>
        </div>
        <div class="me-2">
            <label for="cpf_search" class="form-label">Buscar por CPF:</label>
            <input class="form-control" type="search" placeholder="Digite o CPF" name="cpf_search"
                value="{{ cpf_filter }}">

        </div>
        <br>

    </form>
</div>
<h2 id="dados" style="text-align: center;">Dados dos pacientes</h2>
<br>
<div class="container">
    <div class="flex-container">
        <div class="container">
            <table class="table table-striped">
                <thead>
                    <tr>
                        <th>ID</th>
                        <th>Nome</th>
                        <th>Data de Nascimento</th>
                        <th>CPF</th>
                        <th>Email</th>
                        <th>Status</th>
                        <th>Ações</th>
                    </tr>
                </thead>
                <tbody>
                    {% for paciente_ in pacientes %}
                    {% if not paciente_.is_superuser %}
                    <tr>
                        <td>{{ paciente_.id }}</td>
                        <td>
                            {% if paciente_.nome %}
                            {{ paciente_.nome }}
                            {% else %}
                            Não informado
                            {% endif %}
                        </td>
                        <td>{{ paciente_.data_de_nascimento | date:'d/m/Y' }}</td>
                        <td>{{ paciente_.cpf }}</td>
                        <td>{{ paciente_.email }}</td>
                        <td>
                            {% if paciente_.is_staff %}
                            <span class="badge bg-danger">Funcionário(a)</span>
                            {% else %}
                            Paciente
                            {% endif %}
                        </td>
                        <td>
                            <a class="btn btn-sm btn-secondary"
                                href="{% url 'editar_paciente' id_paciente=paciente_.id id_adm=adm.id %}">Editar</a>
                            <a class="btn btn-sm btn-danger"
                                href="{% url 'remover_paciente' id=paciente_.id id_adm=adm.id %}">Remover</a>
                        </td>
                    </tr>
                    {% endif %}
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>

    <br>

    <div class="pagination">
        <span class="step-links">
            {% if pacientes.has_previous %}
            <a
                href="?pacientes_page=1{% if search_query %}&search={{ search_query }}{% endif %}{% if cpf_filter %}&cpf_search={{ cpf_filter }}{% endif %}">«
                Primeira</a>
            <a
                href="?pacientes_page={{ pacientes.previous_page_number }}{% if search_query %}&search={{ search_query }}{% endif %}{% if cpf_filter %}&cpf_search={{ cpf_filter }}{% endif %}">Anterior</a>
            {% endif %}

            <span class="current">
                Página {{ pacientes.number }} de {{ pacientes.paginator.num_pages }}.
            </span>

            {% if pacientes.has_next %}
            <a
                href="?pacientes_page={{ pacientes.next_page_number }}{% if search_query %}&search={{ search_query }}{% endif %}{% if cpf_filter %}&cpf_search={{ cpf_filter }}{% endif %}">Próxima</a>
            <a
                href="?pacientes_page={{ pacientes.paginator.num_pages }}{% if search_query %}&search={{ search_query }}{% endif %}{% if cpf_filter %}&cpf_search={{ cpf_filter }}{% endif %}">Última
                »</a>
            {% endif %}
        </span>
    </div>


    <h2 id="todas_as_consultas" style="text-align: center;">Todas as consultas marcadas</h2>
    <br>
    <br>
    
      <div class="container mt-3">
    <form method="get" class="d-flex mb-3">
        <div class="me-2">
            <label for="medico_cpf_search" class="form-label">Buscar por CPF do Médico:</label>
            <input class="form-control" type="search" placeholder="Digite o CPF do Médico" name="medico_cpf_search"
                value="{{ medico_cpf_filter }}">
                
        </div>
          <div class="me-2">
             <label for="paciente_cpf_search" class="form-label">Buscar por CPF do Paciente:</label>
             <br>
             
             <input class="form-control" type="search" placeholder="Digite o CPF do Paciente" name="paciente_cpf_search" value="{{ paciente_cpf_filter }}">
             
             <br>
             <button class="btn btn-sm btn-primary" type="submit">Buscar</button>
            
        </div>
        <br>
        

    </form>
</div>

    <div class="flex-container container">
        <div class="container">
            {% if agendamentos %}
            <table class="table table-striped">
                <thead>
                    <tr>
                        <th>Médico(a)</th>
                        <th>Paciente</th>
                        <th>Email do Paciente</th>
                        <th>Especialidade</th>
                        <th>Data</th>
                        <th>Hora</th>
                    </tr>
                </thead>
                <tbody>
                    {% for agendamento in agendamentos %}
                    <tr>
                        <td>{{ agendamento.medico.nome }}</td>
                        <td>
                            {% if agendamento.paciente.nome %}
                            {{ agendamento.paciente.nome }}
                            {% else %}
                            Não informado
                            {% endif %}
                        </td>
                        <td>{{ agendamento.paciente.email }}</td>
                        <td>{{ agendamento.medico.especialidade }}</td>
                        <td>{{ agendamento.data | date:'d/m/Y' }}</td>
                        <td>{{ agendamento.hora|date:"H:i" }}</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
            {% else %}
            <h3 class="text-center text-danger">Sem consultas agendadas</h3>
            {% endif %}
        </div>
    </div>

    <!-- Paginação para os agendamentos -->
    <div class="pagination">
    <span class="step-links">
        {% if agendamentos.has_previous %}
            <a href="?agendamentos_page=1{% if search_query %}&search={{ search_query }}{% endif %}{% if cpf_filter %}&cpf_search={{ cpf_filter }}{% endif %}{% if medico_cpf_filter %}&medico_cpf_search={{medico_cpf_filter}}{% endif %}{% if paciente_cpf_filter %}&paciente_cpf_search={{paciente_cpf_filter}}{% endif %}#todas_as_consultas">« Primeira</a>
            <a href="?agendamentos_page={{ agendamentos.previous_page_number }}{% if search_query %}&search={{ search_query }}{% endif %}{% if cpf_filter %}&cpf_search={{ cpf_filter }}{% endif %}{% if medico_cpf_filter %}&medico_cpf_search={{medico_cpf_filter}}{% endif %}{% if paciente_cpf_filter %}&paciente_cpf_search={{paciente_cpf_filter}}{% endif %}#todas_as_consultas">Anterior</a>
        {% endif %}

        <span class="current">
            Página {{ agendamentos.number }} de {{ agendamentos.paginator.num_pages }}.
        </span>

        {% if agendamentos.has_next %}
            <a href="?agendamentos_page={{ agendamentos.next_page_number }}{% if search_query %}&search={{ search_query }}{% endif %}{% if cpf_filter %}&cpf_search={{ cpf_filter }}{% endif %}{% if medico_cpf_filter %}&medico_cpf_search={{medico_cpf_filter}}{% endif %}{% if paciente_cpf_filter %}&paciente_cpf_search={{paciente_cpf_filter}}{% endif %}#todas_as_consultas">Próxima</a>
            <a href="?agendamentos_page={{ agendamentos.paginator.num_pages }}{% if search_query %}&search={{ search_query }}{% endif %}{% if cpf_filter %}&cpf_search={{ cpf_filter }}{% endif %}{% if medico_cpf_filter %}&medico_cpf_search={{medico_cpf_filter}}{% endif %}{% if paciente_cpf_filter %}&paciente_cpf_search={{paciente_cpf_filter}}{% endif %}#todas_as_consultas">Última »</a>
        {% endif %}
    </span>
</div>
</div>

<div class="container mt-5">
    <div id="div-title-cadatro">
        <h2 id="cadastro" style="text-align: center;">Cadastre um novo paciente</h2>
    </div>

    <div class="container">
        <!-- Centraliza o formulário -->
        <div class="col-md-6" id="div-form-cadastro">
            <!-- Define a largura máxima do formulário em telas médias -->
            <form method="POST" class="form-group">
                {% csrf_token %}
                {% for field in form %}
                <div class="form-group">
                    <label for="{{ field.id_for_label }}" class="form-label">{{ field.label }}</label>
                    {{ field }}
                    {% if field.errors %}
                    <ul class="errors">
                        {% for error in field.errors %}
                        <li class="text-danger">{{ error }}</li>
                        {% endfor %}
                    </ul>
                    {% endif %}
                </div>
                {% endfor %}
                <button type="submit" class="btn btn-primary">Cadastrar</button>
            </form>
            <br>
            <br>

            <br>
        </div>
    </div>


</div>
{% endblock %}